"use strict";angular.module("stockExchangeApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","chart.js"]).config(["$routeProvider","$locationProvider",function(a,b){a.otherwise({redirectTo:"/"}),b.html5Mode(!0)}]).config(["ChartJsProvider",function(a){a.setOptions({responsive:!0,animationEasing:"linear"})}]),angular.module("stockExchangeApp").controller("MainCtrl",["$scope","Stocks",function(a,b){function c(){b.getAllStocks(function(b){a.data=[],a.labels=[],a.series=[],b.length>0&&(b[0].data.forEach(function(b){a.labels.push(b[0])}),b.forEach(function(b){a.series.push(b._id);var c=[];b.data.forEach(function(a){c.push(a[1])}),a.data.push(c)}))})}a.data=[],a.labels=[],a.series=[],a.onClick=function(a,b){console.log(a,b)},a.$on("updateStocks",function(){c()})}]),angular.module("stockExchangeApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("stockExchangeApp").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("stockExchangeApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop;return d.save(a,function(b){return e.put("token",b.token),g=d.get(),c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},getToken:function(){return e.get("token")}}}]),angular.module("stockExchangeApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("stockExchangeApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("stockExchangeApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("stockExchangeApp").controller("NavbarCtrl",["$scope","$rootScope","Stocks",function(a,b,c){function d(){a.symbols=[],c.getAllIds(function(b){b.forEach(function(b){a.symbols.push(b)})},function(a){console.warn(a)})}function e(){delete a.message,a.error=!1}function f(){delete a.statusMessage,a.status=!1}function g(b){a.error=!0,a.message=b}function h(b){a.status=!0,a.statusMessage=b}a.symInput="",a.symbols=[],a.error=!1,a.status=!1,a.getStock=function(){e(),f(),a.symInput.toUpperCase(),h("Fetching stock"),a.symbols.indexOf(a.symInput)<0?c.addStock({_id:a.symInput.toUpperCase()},function(){b.$broadcast("updateStocks"),f()},function(){g("Enter a valid stock symbol")}):g("no dups"),delete a.symInput},a.removeStock=function(d){console.log(d),h("Removing stock"),c.deleteStock({id:d},function(){var c=a.symbols.indexOf(d);a.symbols.splice(c,1),b.$broadcast("updateStocks"),f()},function(){g("delete failed")})},a.$on("updateStocks",function(){d()}),b.$broadcast("updateStocks")}]),angular.module("stockExchangeApp").factory("Stocks",["$resource",function(a){return a("/api/stocks/:id/:controller",{id:"@_id"},{getAllStocks:{method:"GET",isArray:!0},getAllIds:{method:"GET",isArray:!0,params:{controller:"byId"}},addStock:{method:"POST"},deleteStock:{method:"DELETE"}})}]),angular.module("stockExchangeApp").run(["$templateCache",function(a){a.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container-fluid ng-show="data.length > 0"><div class=row><div class="col-md-10 col-md-offset-1"><canvas id=line class="chart chart-line" data=data labels=labels legend=true series=series click=onClick></canvas></div></div></div><div class=container-fluid style="margin-top: 100px"><div class=row><div class="col-md-4 col-md-offset-4"><h1 ng-show="data.length === 0">Add a stock...</h1></div></div></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-inverse navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand>stock-exchange</a><form class="navbar-search pull-left main-search"><input class=search-query placeholder="enter symbol" ng-model=symInput ng-enter=getStock()></form><ul class="nav navbar-nav list-inline"><div class=inline ng-repeat="symbol in symbols"><li>{{symbol}}<span ng-click=removeStock(symbol)><i class="fa fa-minus fa-sm" style=color:white></i></span></li></div><div class=inline ng-show=error><li style=color:red;background-color:grey><i class="fa fa-exclamation" style=color:red></i> {{message}} <i class="fa fa-exclamation" style=color:red></i></li></div><div class=inline ng-show=status><li style=color:green;background-color:grey>{{statusMessage}} <i class="fa fa-exclamation" style=color:green></i></li></div></ul></div></div></div>')}]);